# TIMEOUT Hotel Management System - Руководство по установке

## Данные для входа

После запуска сидеров созданы следующие учетные записи:

### Администратор
- **Email**: `admin@timeout.com`
- **Пароль**: `admin123`
- **Роль**: ADMIN
- **Доступ**: Полный доступ к админ-панели

### Менеджер
- **Email**: `manager@timeout.com`
- **Пароль**: `user123`
- **Роль**: MANAGER
- **Доступ**: Доступ к админ-панели

### Клиенты
1. **Иван Петров**
   - Email: `ivan@example.com`
   - Пароль: `user123`

2. **Мария Иванова**
   - Email: `maria@example.com`
   - Пароль: `user123`

## Быстрый старт

### 1. Установка зависимостей
```bash
npm install
```

### 2. Настройка базы данных

Убедитесь, что в файле `.env` указана правильная строка подключения:
```env
DATABASE_URL='postgresql://...'
JWT_SECRET='your-secret-key-change-in-production'
```

### 3. Применение миграций
```bash
npx prisma migrate dev
```

### 4. Заполнение базы данных
```bash
npx prisma db seed
```

Эта команда создаст:
- 3 страны (Russia, USA, France)
- 4 города (Moscow, Saint Petersburg, New York, Paris)
- 4 отеля
- 14 номеров
- 4 пользователя (1 admin, 1 manager, 2 клиента)
- 5 статусов бронирования
- 5 способов оплаты
- 15 удобств (amenities)
- 3 скидки

### 5. Генерация Prisma Client
```bash
npx prisma generate
```

### 6. Запуск приложения

**Режим разработки:**
```bash
npm run dev
```

Приложение будет доступно по адресу: `http://localhost:3000`

**Production сборка:**
```bash
npm run build
npm start
```

## Доступ к админ-панели

1. Откройте браузер и перейдите по адресу:
   - `http://localhost:3000/en/auth/login` (английский)
   - `http://localhost:3000/ru/auth/login` (русский)

2. Введите данные администратора:
   - Email: `admin@timeout.com`
   - Пароль: `admin123`

3. После успешного входа вы будете перенаправлены на:
   - `http://localhost:3000/en/admin` (английский)
   - `http://localhost:3000/ru/admin` (русский)

## Многоязычность

Система поддерживает два языка:
- **Английский** (en) - по умолчанию
- **Русский** (ru)

Переключение языка доступно через кнопку с иконкой глобуса в правом верхнем углу.

### URL структура
- Английский: `/en/...`
- Русский: `/ru/...`

Примеры:
- `/en/auth/login` - страница входа на английском
- `/ru/auth/login` - страница входа на русском
- `/en/admin` - админ-панель на английском
- `/ru/admin` - админ-панель на русском

## Структура админ-панели

После входа доступны следующие разделы:

### 1. Dashboard (Панель управления)
- Общая статистика
- Количество отелей, номеров, бронирований
- Общая выручка

### 2. Hotels (Отели)
- Просмотр списка отелей
- Добавление нового отеля
- Редактирование отеля
- Удаление отеля

### 3. Rooms (Номера)
- Управление номерами
- Типы номеров
- Цены и доступность

### 4. Bookings (Бронирования)
- Просмотр всех бронирований
- Информация о гостях
- Статусы бронирований

### 5. Users (Пользователи)
- Управление пользователями
- Роли и права доступа
- Статистика по пользователям

### 6. Reviews (Отзывы)
- Модерация отзывов
- Одобрение/отклонение
- Рейтинги отелей

### 7. Discounts (Скидки)
- Промокоды
- Типы скидок
- Период действия

## Устранение неполадок

### Проблема: Не могу войти в админку

**Решение 1**: Проверьте логи в консоли браузера
1. Откройте DevTools (F12)
2. Перейдите во вкладку Console
3. Попробуйте войти снова
4. Проверьте ошибки

**Решение 2**: Проверьте логи сервера
```bash
# В терминале где запущен npm run dev
# Вы увидите логи вида:
# Login attempt for email: admin@timeout.com
# User found: Yes (admin@timeout.com, role: ADMIN)
# Password valid: true
# Token created for user: admin@timeout.com with role: ADMIN
```

**Решение 3**: Проверьте cookies
1. Откройте DevTools (F12)
2. Перейдите в Application > Cookies
3. Проверьте наличие cookie с именем `token`
4. Если cookie нет, проверьте настройки браузера

**Решение 4**: Очистите кэш и cookies
1. Ctrl+Shift+Delete
2. Очистите cookies и кэш
3. Перезагрузите страницу
4. Попробуйте войти снова

**Решение 5**: Пересоздайте пользователя
```bash
# Удалите существующих пользователей и создайте заново
npx prisma migrate reset
npx prisma db seed
```

### Проблема: 404 Not Found на страницах

Убедитесь, что вы используете правильные URL с локалью:
- ❌ `/admin` - неправильно
- ✅ `/en/admin` - правильно
- ✅ `/ru/admin` - правильно

### Проблема: Ошибка подключения к базе данных

Проверьте:
1. `DATABASE_URL` в файле `.env`
2. База данных запущена и доступна
3. Правильные учетные данные

```bash
# Проверьте подключение
npx prisma db pull
```

### Проблема: Prisma Client не сгенерирован

```bash
npx prisma generate
```

## Полезные команды

```bash
# Просмотр базы данных в браузере
npx prisma studio

# Применить миграции
npx prisma migrate dev

# Сбросить базу данных (удалит все данные!)
npx prisma migrate reset

# Проверка схемы
npx prisma validate

# Форматирование схемы
npx prisma format
```

## Production развертывание

### Перед развертыванием:

1. **Измените JWT_SECRET**:
   ```env
   JWT_SECRET='сгенерируйте-длинный-случайный-ключ-минимум-32-символа'
   ```

2. **Настройте production базу данных**:
   ```env
   DATABASE_URL='postgresql://production-db-url'
   ```

3. **Примените миграции**:
   ```bash
   npx prisma migrate deploy
   ```

4. **Заполните базу данных** (если нужно):
   ```bash
   npx prisma db seed
   ```

5. **Создайте production сборку**:
   ```bash
   npm run build
   ```

## Поддержка

Если возникли проблемы:
1. Проверьте логи в консоли браузера (F12)
2. Проверьте логи сервера в терминале
3. Убедитесь что все зависимости установлены: `npm install`
4. Попробуйте пересоздать базу: `npx prisma migrate reset`
5. Проверьте версии Node.js (должна быть 18+)

## Дополнительная информация

- **Документация Next.js**: https://nextjs.org/docs
- **Документация Prisma**: https://www.prisma.io/docs
- **Документация next-intl**: https://next-intl-docs.vercel.app
